<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio | Montgomery AI</title>
  <link rel="stylesheet" href="/styles/apple.css">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
html {
  scroll-behavior: smooth;
}

    /* Glassmorphism styles */
    .card {
      background: rgba(30, 30, 36, 0.6);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    body {
      background: var(--bg-primary);
      color: #fff;
      font-family: var(--font);
      min-height: 100vh;
      padding: 60px 20px;
    }
    
    h1 { font-size: 2.5rem; margin-bottom: 8px; text-align: center; }
    .subtitle { color: #a1a1aa; margin-bottom: 30px; text-align: center; }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    
    .total-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 3rem;
      font-weight: 700;
    }
    
    .change { font-size: 1.2rem; margin-left: 12px; }
    .positive { color: var(--bull); }
    .negative { color: var(--bear); }
    
    .add-form {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    input, select {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--bg-primary);
      color: #fff;
      font-family: var(--font);
    }
    
    input { flex: 1; min-width: 100px; }
    
    button {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      cursor: pointer;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.08); }
    th { color: #71717a; font-weight: 500; font-size: 0.85rem; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .holdings-list { display: flex; flex-direction: column; gap: 8px; }
    .holding-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    .holding-coin { font-weight: 600; }
    .holding-amt { color: #a1a1aa; }
    .holding-value { font-family: 'JetBrains Mono', monospace; }
    
    .chart-container { height: 250px; }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .total-portfolio-value {
      font-size: 4rem;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 10px;
    }
  
    :root {
      --font: 'Outfit', sans-serif;
      --bg-primary: #121217;
      --bg-secondary: #1e1e24;
      --accent: #7bffb1;
      --bull: #26a69a;
      --bear: #ef5350;
    }
    
    body {
      background: var(--bg-primary);
      color: #fff;
      font-family: var(--font);
      min-height: 100vh;
      padding: 60px 20px;
    }
    
    h1 { font-size: 1.8rem; margin-bottom: 8px; }
    .subtitle { color: #a1a1aa; margin-bottom: 30px; }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 24px;
    }
    
    .total-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 3rem;
      font-weight: 700;
    }
    
    .change { font-size: 1.2rem; margin-left: 12px; }
    .positive { color: var(--bull); }
    .negative { color: var(--bear); }
    
    .add-form {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    input, select {
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--bg-primary);
      color: #fff;
      font-family: var(--font);
    }
    
    input { flex: 1; min-width: 100px; }
    
    button {
      padding: 12px 24px;
      border-radius: 10px;
      border: none;
      background: var(--accent);
      color: #000;
      font-weight: 600;
      cursor: pointer;
    }
    
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.08); }
    th { color: #71717a; font-weight: 500; font-size: 0.85rem; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .holdings-list { display: flex; flex-direction: column; gap: 8px; }
    .holding-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    .holding-coin { font-weight: 600; }
    .holding-amt { color: #a1a1aa; }
    .holding-value { font-family: 'JetBrains Mono', monospace; }
    
    .chart-container { height: 250px; }
  </style>
</head>
<body>
<div class="header">
    <h1>ðŸ’¼ Portfolio Tracker</h1>
    <p class="subtitle">Track your crypto holdings in real-time</p>
    <div class="total-portfolio-value">$<span id="total">0.00</span></div>
    <span class="change" id="change">+0.00%</span>
  </div>
  
  <div class="grid">
    <div class="card">
      <div style="color: #71717a; margin-bottom: 8px;">Total Value</div>
      <div class="total-value">
        $<span id="total">0.00</span>
        <span class="change" id="change">+0.00%</span>
      </div>
    </div>
    
    <div class="card">
      <div style="color: #71717a; margin-bottom: 16px;">Allocation</div>
      <div class="chart-container">
        <canvas id="chart"></canvas>
      </div>
    </div>
  </div>
  
  <div class="card" style="max-width: 1200px; margin: 20px auto;">
    <h3 style="margin-bottom: 16px;">Add Holding</h3>
    <form class="add-form" onsubmit="addHolding(event)">
      <input type="text" id="coin" placeholder="Coin (e.g. BTC)" required style="text-transform: uppercase;">
      <input type="number" id="amount" placeholder="Amount" step="any" required>
      <button type="submit">Add</button>
    </form>
    
    <h3 style="margin: 24px 0 16px;">Holdings</h3>
    <div id="holdings" class="holdings-list"></div>
  </div>
  
  <script>
    const API_KEY = '3d79d057a66e65a870a114ac10cd895c';
    let holdings = JSON.parse(localStorage.getItem('portfolio-holdings') || '[]');
    let prices = {};
    let chart;
    
    async function fetchPrices() {
      try {
        const res = await fetch('/api/prices?key=' + API_KEY);
        const data = await res.json();
        prices = {};
        (data.prices || []).forEach(p => prices[p.coin] = p);
      } catch(e) { console.log(e); }
    }
    
    async function update() {
      await fetchPrices();
      renderHoldings();
      updateChart();
    }
    
    function renderHoldings() {
      const container = document.getElementById('holdings');
      let total = 0;
      let total24h = 0;
      
      container.innerHTML = holdings.map(h => {
        const price = prices[h.coin]?.price || 0;
        const value = price * h.amount;
        const change = prices[h.coin]?.change_24h_pct || 0;
        total += value;
        total24h += value * (change / 100);
        
        return `<div class="holding-row">
          <div>
            <span class="holding-coin">${h.coin}</span>
            <span class="holding-amt">${h.amount}</span>
          </div>
          <div style="text-align:right;">
            <div class="holding-value">$${value.toLocaleString()}</div>
            <div class="${change >= 0 ? 'positive' : 'negative'}" style="font-size:0.85rem;">${change >= 0 ? '+' : ''}${change.toFixed(2)}%</div>
          </div>
        </div>`;
      }).join('');
      
      const totalChange = total > 0 ? (total24h / (total - total24h) * 100) : 0;
document.querySelector('.total-portfolio-value').innerHTML = '$<span id="total">' + total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + '</span>';
      const changeEl = document.querySelector('.change');
      changeEl.textContent = (totalChange >= 0 ? '+' : '') + totalChange.toFixed(2) + '%';
      changeEl.className = 'change ' + (totalChange >= 0 ? 'positive' : 'negative');
    }
    function updateChart() {
      const labels = [];
      const data = [];
      holdings.forEach(h => {
        const price = prices[h.coin]?.price || 0;
        labels.push(h.coin);
        data.push(price * h.amount);
      });
      
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('chart'), {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{ data, backgroundColor: ['#7bffb1', '#a78bfa', '#6366f1', '#f59e0b', '#ef5350', '#10b981'] }]
        },
        options: {
          plugins: { legend: { position: 'right', labels: { color: '#fff' } } }
        }
      });
    }
    
    function addHolding(e) {
      e.preventDefault();
      const coin = document.getElementById('coin').value.toUpperCase();
      const amount = parseFloat(document.getElementById('amount').value);
      holdings.push({ coin, amount });
      localStorage.setItem('portfolio-holdings', JSON.stringify(holdings));
      e.target.reset();
      update();
    }
    
    update();
    setInterval(update, 30000);
  </script>
</body>
</html>
