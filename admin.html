<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin | Montgomery AI Labs</title>
  <link rel="stylesheet" href="/styles/apple.css">
  <style>
    body { background: var(--bg-primary); padding: 60px 16px 100px; max-width: 900px; margin: 0 auto; }
    h1 { font-size: 1.8rem; margin-bottom: 24px; }
    .section { background: var(--bg-tertiary); border-radius: 12px; padding: 16px; margin-bottom: 16px; }
    .section h3 { margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
    .status-dot.green { background: var(--green); }
    .status-dot.red { background: var(--red); }
    .btn { padding: 10px 20px; background: var(--blue); color: white; border: none; border-radius: 8px; cursor: pointer; margin: 4px; }
    .btn:hover { opacity: 0.9; }
    .btn.danger { background: var(--red); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; text-align: left; border-bottom: 1px solid var(--glass-border); }
    th { color: var(--text-tertiary); font-weight: 500; }
    .stat { font-size: 1.5rem; font-weight: 700; }
    .stat-label { font-size: 0.8rem; color: var(--text-tertiary); }
  </style>
</head>
<body>
  <h1>‚öôÔ∏è Admin Panel</h1>
  
  <!-- System Health -->
  <div class="section">
    <h3>üü¢ System Health</h3>
    <table id="processes">
      <tr><th>Process</th><th>Status</th><th>Uptime</th></tr>
    </table>
  </div>
  
  <!-- Cron Overview -->
  <div class="section">
    <h3>‚è∞ Cron Jobs</h3>
    <table id="crons">
      <tr><th>Job</th><th>Schedule</th><th>Last Run</th><th>Status</th></tr>
    </table>
  </div>
  
  <!-- Quick Actions -->
  <div class="section">
    <h3>‚ö° Quick Actions</h3>
    <button class="btn" onclick="runAction('restart-api')">Restart API Server</button>
    <button class="btn" onclick="runAction('rsi-scan')">Run RSI Scan</button>
    <button class="btn" onclick="runAction('run-fetcher')">Run Fetcher</button>
    <button class="btn" onclick="runAction('generate-briefs')">Generate Briefs</button>
  </div>
  
  <!-- Positions Summary -->
  <div class="section">
    <h3>üìä Positions</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
      <div><div class="stat" id="total-positions">--</div><div class="stat-label">Open Positions</div></div>
      <div><div class="stat" id="raoul-pnl">--</div><div class="stat-label">Raoul P&L</div></div>
      <div><div class="stat" id="ben-pnl">--</div><div class="stat-label">Ben P&L</div></div>
    </div>
  </div>
  
  <!-- API Usage -->
  <div class="section">
    <h3>üìà API Usage</h3>
    <div class="stat" id="api-calls">--</div>
    <div class="stat-label">Calls in last hour</div>
  </div>

  <script>
    const API_KEY = '3d79d057a66e65a870a114ac10cd895c';
    
    // Check auth
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('key') !== API_KEY) {
      document.body.innerHTML = '<h1>üîí Access Denied</h1><p>Invalid API key</p>';
    }
    
    // Load system status
    async function loadStatus() {
      // Check processes
      const procs = [
        {name: 'API Server', cmd: '2026-02-20-api-server'},
        {name: 'Auto-Trader', cmd: 'auto-trader'},
        {name: 'SL/TP Manager', cmd: 'sl-tp-manager'},
        {name: 'Watchdog', cmd: 'watchdog'}
      ];
      
      let html = '<tr><th>Process</th><th>Status</th><th>PID</th></tr>';
      for (const p of procs) {
        // Simplified check
        html += `<tr><td>${p.name}</td><td><span class="status-dot green">‚óè</span> Running</td><td>--</td></tr>`;
      }
      document.getElementById('processes').innerHTML = html;
      
      // Load crons
      const crons = [
        {name: 'RSI Monitor', schedule: '*/15'},
        {name: 'Signal Quality', schedule: '*/30'},
        {name: 'OHLCV Cache', schedule: '*/30'},
        {name: 'Auto Trader', schedule: '*/15'},
        {name: 'Daily Health', schedule: '00:01'}
      ];
      
      html = '<tr><th>Job</th><th>Schedule</th><th>Last Run</th><th>Status</th></tr>';
      for (const c of crons) {
        html += `<tr><td>${c.name}</td><td>${c.schedule}</td><td>--</td><td><span class="status-dot green">‚óè</span></td></tr>`;
      }
      document.getElementById('crons').innerHTML = html;
      
      // API calls (placeholder)
      document.getElementById('api-calls').textContent = '~1,247';
    }
    
    // Quick actions
    async function runAction(action) {
      const btns = document.querySelectorAll('.btn');
      btns.forEach(b => b.disabled = true);
      
      alert('Action: ' + action + ' (demo - would execute in production)');
      
      btns.forEach(b => b.disabled = false);
    }
    
    loadStatus();
    loadLogs();
    setInterval(loadStatus, 30000);
  </script>

  <!-- Logs Section -->
  <div class="section">
    <h3>üìã Logs</h3>
    <details>
      <summary style="cursor:pointer;padding:8px;">Seeker Fetcher</summary>
      <pre id="log-fetcher" style="background:#000;padding:12px;border-radius:8px;font-size:0.75rem;max-height:200px;overflow:auto;">Loading...</pre>
    </details>
    <details>
      <summary style="cursor:pointer;padding:8px;">API Server</summary>
      <pre id="log-api" style="background:#000;padding:12px;border-radius:8px;font-size:0.75rem;max-height:200px;overflow:auto;">Loading...</pre>
    </details>
    <details>
      <summary style="cursor:pointer;padding:8px;">Summariser</summary>
      <pre id="log-summariser" style="background:#000;padding:12px;border-radius:8px;font-size:0.75rem;max-height:200px;overflow:auto;">Loading...</pre>
    </details>
  </div>

</body>
</html>
