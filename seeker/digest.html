<!DOCTYPE html>
<html lang="en">
<head>
  <style>body{background:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,sans-serif;margin:0}.glass{background:#1C1C1E;border-radius:12px;padding:16px;margin:0 16px 16px}.btn{padding:12px 20px;border-radius:8px;border:none;font-weight:600;cursor:pointer}.btn-primary{background:#0A84FF;color:#fff}.btn-secondary{background:#2C2C2E;color:#fff}.text-muted{color:#8E8E93}.text-sm{font-size:0.85rem}@media(max-width:600px){.grid{grid-template-columns:1fr!important}}</style>
  <meta charset="UTF-8">
  meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Seeker">
  <link rel="apple-touch-icon" href="/seeker/icons/icon-192.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Solana Seeker">
  <meta property="og:description" content="Your Solana news hub - AI-curated daily digests">
  <meta property="og:image" content="/seeker/seeker-og.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”®</text></svg>">
  <title>Digest | Solana Seeker</title>
  <link rel="manifest" href="/seeker/manifest.json">
  <link rel="stylesheet" href="/seeker/styles.css">
</head>
<body>
  <button onclick="toggleTheme()" style="position:fixed;top:12px;right:12px;background:none;border:none;font-size:1.2rem;z-index:100;">ğŸŒ™</button>
  <header class="page-header">
    <a href="/seeker/index.html" style="color:var(--text-secondary)">â† Back</a>
    <button onclick="loadDigest()" style="background:none;border:none;font-size:1.2rem;margin-right:12px;">ğŸ”„</button><h1>ğŸ”” Today's Digests</h1><button onclick="loadDigest()" style="background:none;border:none;font-size:1.2rem;">ğŸ”„</button>
    <button onclick="shareDigests()" style="background:none;border:none;font-size:1.2rem;">ğŸ“¤</button>
  </header>

  <!-- Countdown -->
  <div class="countdown">
    <div class="text-sm text-muted">Next digest</div>
    <div class="time" id="last-updated" style="font-size:0.75rem;color:var(--text-muted);margin-top:4px;">--:--</div>
  </div>

  <div id="digest-content" style="padding-bottom:80px;"></div>

  <nav class="bottom-nav">
    <a href="/seeker/index.html"><span>ğŸ </span>Feed</a>
    <a href="/seeker/digest.html" class="active"><span>ğŸ””</span>Digest</a>
    <a href="/seeker/projects.html"><span>ğŸŒ</span>Projects</a>
    <a href="/seeker/prices.html">ğŸ’° Prices</a>
    <a href="/seeker/settings.html"><span>âš™ï¸</span>Settings</a>
  </nav>

  <script>
const API_KEY = '3d79d057a66e65a870a114ac10cd895c';
const SESSIONS = [
  {key:'morning',name:'Morning UTC',icon:'ğŸŒ…',time:8},
  {key:'ny',name:'New York',icon:'ğŸ—½',time:13},
  {key:'tokyo',name:'Tokyo',icon:'ğŸ—¼',time:23}
];

function updateCountdown() {
  const now = new Date(), hour = now.getUTCHours();
  const next = SESSIONS.find(s => hour < s.time) || SESSIONS[0];
  const target = new Date(now); target.setUTCHours(next.time,0,0,0);
  if (target <= now) target.setDate(target.getDate() + 1);
  const diff = target - now;
  const h = Math.floor(diff/36e5), m = Math.floor((diff%36e5)/6e4), s = Math.floor((diff%6e4)/1000);
  document.getElementById('countdown').textContent = `${h}h ${m}m ${s}s`;
}

function renderDigest(s, d) {
  const stories = d.stories || [];
  const cats = {}; stories.forEach(s => cats[s.category||'News'] = (cats[s.category||'News']||0)+1);
  const catBadges = Object.entries(cats).map(([c,n]) => `<span class="category" style="font-size:0.65rem">${c} ${n}</span>`).join('');
  
  return `
    <div class="glass" style="margin:0 16px 16px;border-radius:12px;overflow:hidden;">
      <!-- Header -->
      <div style="padding:16px;background:linear-gradient(135deg,var(--accent),#5E5CE6);">
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="font-size:1.5rem;">${s.icon}</span>
          <div>
            <div style="font-weight:700;">${s.name} Solana Brief</div>
            <div class="text-xs" style="opacity:0.8;">ğŸ“… ${new Date().toLocaleDateString()} Â· â± 5 min read</div>
          </div>
        </div>
      </div>
      
      <!-- Teaser -->
      <div style="padding:16px;">
        <p style="font-size:0.95rem;line-height:1.5;color:var(--text-secondary);"><strong>${(d.summary || "").split(".")[0]}.</strong> 'Generating brief...'}</p>
        
        <div style="margin:12px 0;">${catBadges}</div>
        
        <!-- Stories count -->
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;">
          <span class="category">${stories.length} stories</span>
        </div>
        
        <!-- Expand button -->
        <button onclick="this.style.display='none';document.getElementById('stories-${s.key}').style.display='block'" 
                class="btn btn-secondary" style="width:100%;">Read full digest â†’</button>
        
        <!-- Expanded stories -->
        <div id="stories-${s.key}" style="display:none;margin-top:16px;border-top:1px solid var(--glass-border);padding-top:16px;">
          ${stories.slice(0,10).map((st,i) => `
            <a href="${st.url}" target="_blank" style="display:flex;gap:8px;padding:8px 0;border-bottom:1px solid var(--glass-border);text-decoration:none;color:inherit;">
              <span style="color:var(--accent);font-weight:700;min-width:20px;">${i+1}.</span>
              <span style="font-size:0.9rem;">${st.title}</span>
            </a>
          `).join('')}
        </div>
      </div>
    </div>
  `;
}

async function loadDigest() {
  try {
    const res = await fetch('/api/seeker/digest?key=' + API_KEY);
    const data = await res.json();
    document.getElementById('digest-content').innerHTML = SESSIONS.map(s => renderDigest(s, data[s.key]||{})).join('');
  } catch(e) { console.log(e); }
}

async function shareDigests() {
  const res = await fetch('/api/seeker/digest?key=' + API_KEY);
  const data = await res.json();
  const text = SESSIONS.map(s => `${s.name}:\n${(data[s.key]||{}).summary||''}`).join('\n\n');
  if (navigator.share) navigator.share({title:'Solana Digest',text});
  else { await navigator.clipboard.writeText(text); alert('Copied!'); }
}

setInterval(updateCountdown, 1000);
updateCountdown();
loadDigest();
  
    async function loadTrending() {
      try {
        const res = await fetch('/api/seeker/feed?key=' + API_KEY);
        const data = await res.json();
        const articles = data.articles || [];
        
        // Filter to last 2 hours and sort by quality
        const now = Date.now();
        const trending = articles
          .filter(a => {
            // Simple filter - in production would check timestamp
            return a.quality_score > 50;
          })
          .sort((a, b) => (b.quality_score || 0) - (a.quality_score || 0))
          .slice(0, 3);
        
        if (trending.length) {
          document.getElementById('trending-list').innerHTML = trending.map(a => `
            <a href="/seeker/article.html?id=${a.id}" style="min-width: 200px; background: var(--bg-tertiary); border-radius: 8px; padding: 12px; text-decoration: none; color: var(--text-primary); display: block;">
              <div style="font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 4px;">${a.source}</div>
              <div style="font-size: 0.9rem; font-weight: 500; line-height: 1.3;">${(a.title || '').substring(0, 60)}...</div>
            </a>
          `).join('');
        }
      } catch(e) {}
    }
    loadTrending();

  
    async function loadSolanaStats() {
      try {
        // Price
        const res = await fetch('/api/prices?key=' + API_KEY);
        const data = await res.json();
        const sol = (data.prices || []).find(p => p.coin === 'SOL');
        if (sol) {
          document.getElementById('sol-price').textContent = '$' + sol.price.toFixed(2);
        }
        
        // TPS from Solana RPC
        try {
          const rpcRes = await fetch('https://api.mainnet-beta.solana.com', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({jsonrpc:'2.0',id:1,method:'getRecentPerformanceSamples',params:[1]})
          });
          const rpc = await rpcRes.json();
          if (rpc.result && rpc.result[0]) {
            const tps = Math.round(rpc.result[0].numTransactions / rpc.result[0].samplePeriodSecs);
            document.getElementById('sol-tps').textContent = tps.toLocaleString();
          }
        } catch(e) { document.getElementById('sol-tps').textContent = '--'; }
        
        // Validators (placeholder)
        document.getElementById('sol-validators').textContent = '1,450+';
        
        // TVL (placeholder)
        document.getElementById('sol-tvl').innerHTML = '<a href="https://defillama.com/chain/Solana" style="color:inherit;text-decoration:none;">$9.2B</a>';
        
        // Volume
        if (sol) {
          document.getElementById('sol-volume').textContent = (sol.change_24h_pct > 0 ? '+' : '') + sol.change_24h_pct.toFixed(1) + '%';
        }
      } catch(e) { console.log(e); }
    }
    loadSolanaStats();

  
    function saveDigest(sessionKey) {
      const digests = JSON.parse(localStorage.getItem('saved_digests') || '[]');
      
      // Get digest data from the session
      const sessionData = window.digestData?.[sessionKey];
      if (!sessionData) return;
      
      const saved = {
        session: sessionKey,
        date: new Date().toISOString(),
        summary: sessionData.summary || '',
        stories: sessionData.stories || [],
        saved_at: new Date().toISOString()
      };
      
      digests.push(saved);
      localStorage.setItem('saved_digests', JSON.stringify(digests));
      alert('Digest saved âœ“');
    }

  </script>

    <!-- Solana Network Stats -->
    <div class="glass" style="margin: 16px; padding: 16px;">
      <h3 style="margin-bottom: 12px;">ğŸ“Š Solana Network</h3>
      <div id="solana-stats" style="display: flex; gap: 16px; overflow-x: auto; padding: 8px 0;">
        <div style="min-width: 80px; text-align: center;">
          <div class="mono" id="sol-price" style="font-size: 1.1rem; font-weight: 700;">$--</div>
          <div class="text-xs text-muted">SOL Price</div>
        </div>
        <div style="min-width: 80px; text-align: center;">
          <div class="mono" id="sol-volume" style="font-size: 1.1rem; font-weight: 700;">--</div>
          <div class="text-xs text-muted">24h Volume</div>
        </div>
        <div style="min-width: 80px; text-align: center;">
          <div class="mono" id="sol-validators" style="font-size: 1.1rem; font-weight: 700;">--</div>
          <div class="text-xs text-muted">Validators</div>
        </div>
        <div style="min-width: 80px; text-align: center;">
          <div class="mono" id="sol-tps" style="font-size: 1.1rem; font-weight: 700;">--</div>
          <div class="text-xs text-muted">TPS</div>
        </div>
        <div style="min-width: 80px; text-align: center;">
          <div class="mono" id="sol-tvl" style="font-size: 1.1rem; font-weight: 700;">--</div>
          <div class="text-xs text-muted">DeFi TVL</div>
        </div>
      </div>
    </div>

</body>
</html>
