<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”®</text></svg>">
  <title>Alerts | Solana Seeker</title>
  <link rel="manifest" href="/seeker/manifest.json">
  <link rel="stylesheet" href="/seeker/styles.css">
</head>
<body>
  <button onclick="toggleTheme()" style="position:fixed;top:12px;right:12px;background:none;border:none;font-size:1.2rem;z-index:100;">ğŸŒ™</button>
  <header class="page-header">
    <a href="/seeker/index.html" style="color:var(--text-secondary);text-decoration:none;">â† Back</a>
    <h1>ğŸ“£ Alerts</h1>
    <button onclick="markAllRead()" style="background:none;border:none;color:var(--accent);font-size:0.85rem;">Mark all read</button>
  </header>

  <!-- Breaking Alert Banner -->
  <div id="breaking-banner" style="display:none;padding:12px;background:linear-gradient(90deg,#FF453A,#FF6961);color:white;font-weight:600;cursor:pointer;">
    ğŸš¨ <span id="breaking-title"></span>
  </div>

  <div id="notifications-list" style="padding-bottom:80px;"></div>

  <div id="empty" style="display:none;padding:60px;text-align:center;">
    <div style="font-size:3rem;margin-bottom:16px;">ğŸ””</div>
    <p class="text-muted">No notifications yet</p>
  </div>

  <nav class="bottom-nav">
    <a href="/seeker/index.html"><span>ğŸ </span>Feed</a>
    <a href="/seeker/digest.html"><span>ğŸ””</span>Digest</a>
    <a href="/seeker/notifications.html" class="active"><span>ğŸ“£</span>Alerts</a>
    <a href="/seeker/saved.html"><span>ğŸ”–</span>Saved</a>
  </nav>

  <script>
    const API_KEY = '3d79d057a66e65a870a114ac10cd895c';
    
    function timeAgo(ts) {
      const s = Math.floor((Date.now() - new Date(ts)) / 1000);
      if (s < 60) return 'just now';
      if (s < 3600) return Math.floor(s/60) + 'm ago';
      if (s < 86400) return Math.floor(s/3600) + 'h ago';
      return Math.floor(s/86400) + 'd ago';
    }

    function render(ns) {
      if (!ns.length) {
        document.getElementById('empty').style.display = 'block';
        return;
      }
      document.getElementById('empty').style.display = 'none';
      document.getElementById('notifications-list').innerHTML = ns.map(n => `
        <div class="notification-item ${n.read?'':'unread'} ${n.type==='breaking'?'breaking-item':''}" onclick="openNotif('${n.article_id || ''}')">
          <div class="notification-icon ${n.type}">${n.icon}</div>
          <div style="flex:1;">
            <div style="font-weight:600;font-size:0.9rem;">${n.title}</div>
            <div class="text-sm text-muted">${n.message}</div>
            <div class="text-xs text-muted" style="margin-top:4px;">${timeAgo(n.timestamp)}</div>
          </div>
          ${n.read?'':'<div style="width:8px;height:8px;background:var(--accent);border-radius:50%;"></div>'}
        </div>
      `).join('');
    }

    async function load() {
      let ns = JSON.parse(localStorage.getItem('seeker_notifications') || '[]');
      
      // Check for new breaking news
      try {
        const res = await fetch('/api/seeker/feed?key=' + API_KEY);
        const data = await res.json();
        const breaking = (data.articles || []).find(a => a.breaking);
        
        if (breaking) {
          document.getElementById('breaking-banner').style.display = 'block';
          document.getElementById('breaking-title').textContent = breaking.title.slice(0, 50) + '...';
          
          const exists = ns.find(n => n.article_id === breaking.id);
          if (!exists) {
            ns.unshift({
              id: Date.now().toString(),
              type: 'breaking', icon: 'ğŸš¨',
              title: 'Breaking: ' + breaking.title.slice(0, 40),
              message: breaking.category + ' â€¢ ' + timeAgo(breaking.published),
              timestamp: breaking.published, article_id: breaking.id, read: false
            });
            localStorage.setItem('seeker_notifications', JSON.stringify(ns));
          }
        }
      } catch(e) { console.log(e); }
      
      render(ns);
    }

    function markAllRead() {
      let ns = JSON.parse(localStorage.getItem('seeker_notifications') || '[]');
      ns = ns.map(n => ({...n, read: true}));
      localStorage.setItem('seeker_notifications', JSON.stringify(ns));
      render(ns);
    }

    function openNotif(id) {
      if (id) window.location.href = '/seeker/article.html?id=' + id;
    }

    document.getElementById('breaking-banner')?.addEventListener('click', () => {
      window.location.href = '/seeker/index.html';
    });

    load();
  <script>function toggleTheme(){const isDark=document.body.classList.contains("dark");document.body.classList.toggle("dark");localStorage.setItem("seeker_theme",isDark?"light":"dark");document.querySelector("button[onclick^=toggleTheme]").textContent=isDark?"â˜€ï¸":"ğŸŒ™"}if(localStorage.getItem("seeker_theme")==="light"){document.body.classList.remove("dark")}</script>
</body>
</html>
