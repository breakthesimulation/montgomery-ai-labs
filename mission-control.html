<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
  <title>Mission Control | Montgomery AI Labs</title>
    <script src="/js/ws-price-feed.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #08080c;
            --card: #0f0f14;
            --card-hover: #16161d;
            --border: #1e1e28;
            --text: #e4e4e7;
            --text-muted: #71717a;
            --green: #00ff94;
            --green-dim: rgba(0, 255, 148, 0.15);
            --red: #ff4757;
            --red-dim: rgba(255, 71, 87, 0.15);
            --yellow: #fbbf24;
            --yellow-dim: rgba(251, 191, 36, 0.15);
            --blue: #3b82f6;
            --purple: #a855f7;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }
        
        /* Top Bar */
        .top-bar {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 12px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--green), var(--blue));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }
        
        .logo-text {
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .logo-text span {
            color: var(--text-muted);
            font-weight: 400;
        }
        
        .live-prices {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
        }
        
        .price-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .price-symbol {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .price-value {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 500;
            font-size: 1rem;
        }
        
        .price-change {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .price-change.up { color: var(--green); background: var(--green-dim); }
        .price-change.down { color: var(--red); background: var(--red-dim); }
        
        .timestamp {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        /* Navigation */
        .nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .nav-link {
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            border-color: var(--text-muted);
            color: var(--text);
        }
        
        .nav-link.active {
            border-color: var(--green);
            color: var(--green);
            background: var(--green-dim);
        }
        
        /* Agent timestamp */
        .agent-timestamp {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 6px;
            font-family: 'IBM Plex Mono', monospace;
        }
        
        /* Paper Trades */
        .trades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }
        
        .trade-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
        }
        
        .trade-card.open {
            border-color: var(--blue);
        }
        
        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .trade-coin {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .trade-side {
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .trade-side.sell {
            background: var(--red-dim);
            color: var(--red);
        }
        
        .trade-side.buy {
            background: var(--green-dim);
            color: var(--green);
        }
        
        .trade-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 0.8rem;
        }
        
        .trade-detail-label {
            color: var(--text-muted);
        }
        
        .trade-detail-value {
            font-family: 'IBM Plex Mono', monospace;
            text-align: right;
        }
        
        .trade-pnl {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .trade-pnl-value {
            font-weight: 700;
            font-family: 'IBM Plex Mono', monospace;
        }
        
        .trade-pnl-value.positive { color: var(--green); }
        .trade-pnl-value.negative { color: var(--red); }
        
        /* Research Ready */
        .research-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .research-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            transition: all 0.2s;
        }
        
        .research-card:hover {
            border-color: var(--purple);
        }
        
        .research-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .research-meta {
            display: flex;
            gap: 12px;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }
        
        .research-preview {
            font-size: 0.8rem;
            color: var(--text-muted);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .research-link {
            display: inline-block;
            margin-top: 12px;
            color: var(--purple);
            text-decoration: none;
            font-size: 0.8rem;
        }
        
        .research-link:hover {
            text-decoration: underline;
        }
        
        /* Main Layout */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .section {
            margin-bottom: 32px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        
        .section-title {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
        }
        
        /* Agent Grid */
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .agent-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            transition: all 0.2s;
        }
        
        .agent-card:hover {
            border-color: var(--text-muted);
            background: var(--card-hover);
        }
        
        .agent-card.error {
            border-color: var(--red);
            background: var(--red-dim);
        }
        
        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .agent-name {
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .agent-role {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .agent-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .agent-status.active { background: var(--green); box-shadow: 0 0 8px var(--green); }
        .agent-status.idle { background: var(--text-muted); }
        .agent-status.error { background: var(--red); box-shadow: 0 0 8px var(--red); }
        
        .agent-output {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            margin-top: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .agent-error {
            font-size: 0.7rem;
            color: var(--red);
            margin-top: 4px;
        }
        
        /* TA Reports Section */
        .ta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 16px;
        }
        
        .ta-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .ta-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        
        .ta-card.bull::before { background: var(--green); }
        .ta-card.bear::before { background: var(--red); }
        .ta-card.neutral::before { background: var(--text-muted); }
        
        .ta-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .ta-agent {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ta-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .ta-card.bull .ta-avatar { background: var(--green-dim); color: var(--green); }
        .ta-card.bear .ta-avatar { background: var(--red-dim); color: var(--red); }
        
        .ta-agent-name {
            font-weight: 600;
        }
        
        .ta-agent-role {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        
        .ta-direction {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .ta-direction.bull { color: var(--green); }
        .ta-direction.bear { color: var(--red); }
        .ta-direction.sideways { color: var(--yellow); }
        
        .ta-prices {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
            padding: 12px;
            background: var(--bg);
            border-radius: 8px;
        }
        
        .ta-price {
            display: flex;
            flex-direction: column;
        }
        
        .ta-price-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .ta-price-value {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .ta-position {
            background: var(--bg);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }
        
        .ta-position-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        
        .ta-position-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .ta-position-pnl {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
        }
        
        .ta-position-pnl.positive { color: var(--green); }
        .ta-position-pnl.negative { color: var(--red); }
        
        .ta-setup {
            margin-bottom: 16px;
        }
        
        .ta-setup-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .ta-setup-token {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--blue);
        }
        
        .ta-setup-details {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        .ta-summary {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.6;
        }
        
        .ta-timestamp {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 12px;
            text-align: right;
        }
        
        /* Consensus */
        .consensus {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }
        
        .consensus-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .consensus-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .consensus-value.strong-bull { color: var(--green); }
        .consensus-value.strong-bear { color: var(--red); }
        .consensus-value.cautious { color: var(--yellow); }
        
        /* Reports Hub */
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }
        
        .report-category {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
        }
        
        .report-category-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .report-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }
        
        .report-item:last-child {
            border-bottom: none;
        }
        
        .report-name {
            color: var(--text);
            text-decoration: none;
        }
        
        .report-name:hover {
            color: var(--green);
        }
        
        .report-date {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
        
        .no-data {
            color: var(--text-muted);
            font-size: 0.85rem;
            font-style: italic;
            padding: 12px 0;
        }
        
        /* Health Status */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }
        
        .health-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .health-name {
            font-size: 0.8rem;
            margin-bottom: 6px;
        }
        
        .health-status {
            font-size: 0.7rem;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .health-status.running { background: var(--green-dim); color: var(--green); }
        .health-status.stale { background: var(--yellow-dim); color: var(--yellow); }
        .health-status.stopped { background: var(--red-dim); color: var(--red); }
        
        /* Sentiment */
        .sentiment-bar {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .sentiment-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .sentiment-value {
            font-size: 1.2rem;
            font-weight: 700;
        }
        
        .sentiment-value.bullish { color: var(--green); }
        .sentiment-value.bearish { color: var(--red); }
        .sentiment-value.neutral { color: var(--yellow); }
        
        /* Loading state */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-muted);
        }
        
        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .top-bar {
                padding: 12px 16px;
            }
            
            .container {
                padding: 16px;
            }
            
            .ta-grid {
                grid-template-columns: 1fr;
            }
            
            .agent-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .auto-refresh {
            font-size: 0.7rem;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="logo">
            <div class="logo-icon">MC</div>
            <div class="logo-text">Mission Control <span>| Montgomery AI Labs</span></div>
        </div>
        
        <div class="nav">
            <a href="/index.html" class="nav-link">üè† Home</a>
            <a href="/mission-control.html" class="nav-link active">üéØ Mission Control</a>
            <a href="/fogo.html" class="nav-link">üî• Fogo</a>
            <a href="/solana-dex.html" class="nav-link">‚óé Solana</a>
            <a href="/candles.html" class="nav-link">üìä Charts</a>
            <a href="/trading-signals.html" class="nav-link">‚ö° Signals</a>
        </div>
        
        <div class="live-prices" id="live-prices">
            <div class="price-item">
                <span class="price-symbol">BTC</span>
                <span class="price-value" id="price-BTC">--</span>
            </div>
            <div class="price-item">
                <span class="price-symbol">ETH</span>
                <span class="price-value" id="price-ETH">--</span>
            </div>
            <div class="price-item">
                <span class="price-symbol">SOL</span>
                <span class="price-value" id="price-SOL">--</span>
            </div>
        </div>
        
        <div class="timestamp">
            Updated: <span id="update-time">--</span>
            <span class="auto-refresh"> | Auto-refresh 60s</span>
        </div>
    </div>
    
    <div class="container">
        <!-- SECTION 1: Agent Status Panel -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">ü§ñ Agent Status</div>
            </div>
            <div class="agent-grid" id="agent-grid">
                <div class="loading">Loading agents...</div>
            </div>
        </div>
        
        <!-- SECTION 1.5: Paper Trades -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">üìã Paper Trades ‚Äî Open Positions</div>
            </div>
            <div class="trades-grid" id="trades-grid">
                <div class="loading">Loading trades...</div>
            </div>
        </div>
        
        <!-- SECTION 2: TA Reports -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">üìä TA Reports ‚Äî Trading Sessions</div>
            </div>
            
            <div class="ta-grid" id="ta-grid">
                <div class="loading">Loading TA reports...</div>
            </div>
            
            <div class="consensus" id="consensus">
                <div class="consensus-label">Team Consensus</div>
                <div class="consensus-value" id="consensus-value">--</div>
            </div>
        </div>
        
        <!-- SECTION 3: Live Market Snapshot -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">üìà Market Sentiment</div>
            </div>
            <div class="sentiment-bar">
                <div class="sentiment-label">Overall RSI Sentiment</div>
                <div class="sentiment-value bullish" id="sentiment-value">Loading...</div>
            </div>
        </div>
        
        <!-- SECTION 4: Reports Hub -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">üìÅ Reports Hub</div>
            </div>
            
            <div class="reports-grid" id="reports-grid">
                <div class="loading">Loading reports...</div>
            </div>
        </div>
        
        <!-- SECTION 5: System Health -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">‚öôÔ∏è System Health</div>
            </div>
            <div class="health-grid" id="health-grid">
                <div class="loading">Loading health...</div>
            </div>
        </div>
        
        <!-- SECTION 6: Research Ready -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">üîç Research Ready ‚Äî Scout Reports</div>
            </div>
            <div class="research-grid" id="research-grid">
                <div class="loading">Loading research...</div>
            </div>
        </div>
    </div>
    
    <script>
        // State
        let mcData = null;
        
        // Format currency
        function formatCurrency(value) {
            if (value === null || value === undefined) return '--';
            return '$' + parseFloat(value).toLocaleString();
        }
        
        // Format date
        function formatDate(isoString) {
            if (!isoString) return '--';
            const date = new Date(isoString);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        // Render agents
        function renderAgents(data) {
            const grid = document.getElementById('agent-grid');
            
            if (!data.agents || data.agents.length === 0) {
                grid.innerHTML = '<div class="no-data">No agent data available</div>';
                return;
            }
            
            grid.innerHTML = data.agents.map(agent => `
                <div class="agent-card ${agent.error ? 'error' : ''}">
                    <div class="agent-header">
                        <div>
                            <div class="agent-name">${agent.name}</div>
                            <div class="agent-role">${agent.role}</div>
                        </div>
                        <div class="agent-status ${agent.status}"></div>
                    </div>
                    ${agent.last_output ? `
                        <div class="agent-output" title="${agent.last_output}">
                            ${agent.last_output}
                        </div>
                    ` : ''}
                    ${agent.timestamp ? `
                        <div class="agent-timestamp">Last activity: ${formatDate(agent.timestamp)}</div>
                    ` : ''}
                    ${agent.error ? `<div class="agent-error">‚ö†Ô∏è ${agent.error}</div>` : ''}
                </div>
            `).join('');
        }
        
        // Render Paper Trades
        async function renderTrades() {
            const grid = document.getElementById('trades-grid');
            
            try {
                const response = await fetch('/data/hl_paper_trades.json');
                const data = await response.json();
                
                const openTrades = data.trades.filter(t => t.status === 'OPEN');
                
                if (openTrades.length === 0) {
                    grid.innerHTML = '<div class="no-data">No open positions</div>';
                    return;
                }
                
                grid.innerHTML = openTrades.map(trade => {
                    const pnlClass = trade.pnl >= 0 ? 'positive' : 'negative';
                    const pnlSign = trade.pnl >= 0 ? '+' : '';
                    
                    return `
                        <div class="trade-card open">
                            <div class="trade-header">
                                <div class="trade-coin">${trade.coin}</div>
                                <div class="trade-side ${trade.side.toLowerCase()}">${trade.side}</div>
                            </div>
                            <div class="trade-details">
                                <div class="trade-detail-label">Entry</div>
                                <div class="trade-detail-value">$${trade.entry_price.toFixed(4)}</div>
                                <div class="trade-detail-label">Current</div>
                                <div class="trade-detail-value">$${trade.current_price.toFixed(4)}</div>
                                <div class="trade-detail-label">Stop Loss</div>
                                <div class="trade-detail-value">$${trade.stop_loss ? trade.stop_loss.toFixed(4) : '--'}</div>
                                <div class="trade-detail-label">Target</div>
                                <div class="trade-detail-value">$${trade.target ? trade.target.toFixed(4) : '--'}</div>
                            </div>
                            <div class="trade-pnl">
                                <span>P&L</span>
                                <span class="trade-pnl-value ${pnlClass}">${pnlSign}${trade.pnl.toFixed(2)}%</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading trades:', error);
                grid.innerHTML = '<div class="no-data">Error loading trades</div>';
            }
        }
        
        // Render Research
        async function renderResearch() {
            const grid = document.getElementById('research-grid');
            
            try {
                // Fetch recent Scout reports
                const reports = [
                    { title: 'Agent Army Research', date: '2026-02-21', path: '/vault/Scout/2026-02-21-agent-army-research-v2.md', preview: 'Latest research on AI agent strategies and deployment patterns.' },
                    { title: 'Polymarket Strategies', date: '2026-02-18', path: '/vault/Scout/2026-02-18-polymarket-strategies.md', preview: 'Analysis of prediction market opportunities and strategies.' },
                    { title: 'On-Chain Analytics', date: '2026-02-18', path: '/vault/Scout/2026-02-18-onchain-analytics-feb18.md', preview: 'Deep dive into blockchain metrics and wallet movements.' }
                ];
                
                grid.innerHTML = reports.map(report => `
                    <div class="research-card">
                        <div class="research-title">${report.title}</div>
                        <div class="research-meta">
                            <span>üìÖ ${report.date}</span>
                            <span>üìÅ Scout</span>
                        </div>
                        <div class="research-preview">${report.preview}</div>
                        <a href="${report.path}" class="research-link" target="_blank">Read Report ‚Üí</a>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading research:', error);
                grid.innerHTML = '<div class="no-data">Error loading research</div>';
            }
        }
        
        // Determine direction from signal
        function getDirection(session) {
            if (!session) return 'sideways';
            const dir = (session.direction || '').toLowerCase();
            if (dir.includes('bull')) return 'bull';
            if (dir.includes('bear')) return 'bear';
            return 'sideways';
        }
        
        // Render TA Reports
        function renderTAReports(raoul, ben) {
            const grid = document.getElementById('ta-grid');
            
            let html = '';
            
            // Raoul (Bull) card
            const raoulLatest = raoul.sessions && raoul.sessions.length > 0 ? raoul.sessions[raoul.sessions.length - 1] : null;
            const raoulDir = getDirection(raoulLatest);
            
            html += `
                <div class="ta-card bull">
                    <div class="ta-header">
                        <div class="ta-agent">
                            <div class="ta-avatar">R</div>
                            <div>
                                <div class="ta-agent-name">Raoul</div>
                                <div class="ta-agent-role">VP Bull</div>
                            </div>
                        </div>
                        <div class="ta-direction bull">${raoulDir === 'bull' ? '‚Üë' : raoulDir === 'bear' ? '‚Üì' : '‚Üí'}</div>
                    </div>
                    ${raoulLatest && raoulLatest.btc_price ? `
                        <div class="ta-prices">
                            <div class="ta-price">
                                <span class="ta-price-label">BTC</span>
                                <span class="ta-price-value">$${parseFloat(raoulLatest.btc_price).toLocaleString()}</span>
                            </div>
                            <div class="ta-price">
                                <span class="ta-price-label">ETH</span>
                                <span class="ta-price-value">$${parseFloat(raoulLatest.eth_price).toLocaleString()}</span>
                            </div>
                        </div>
                    ` : ''}
                    ${raoulLatest && raoulLatest.open_position ? `
                        <div class="ta-position">
                            <div class="ta-position-label">Open Position</div>
                            <div class="ta-position-row">
                                <span>${raoulLatest.open_position.token} Long @ $${raoulLatest.open_position.entry}</span>
                                <span class="ta-position-pnl ${parseFloat(raoulLatest.open_position.current) >= parseFloat(raoulLatest.open_position.entry) ? 'positive' : 'negative'}">
                                    ${((parseFloat(raoulLatest.open_position.current) - parseFloat(raoulLatest.open_position.entry)) / parseFloat(raoulLatest.open_position.entry) * 100).toFixed(2)}%
                                </span>
                            </div>
                        </div>
                    ` : ''}
                    ${raoulLatest && raoulLatest.top_setup ? `
                        <div class="ta-setup">
                            <div class="ta-setup-label">Top Setup</div>
                            <div class="ta-setup-token">${raoulLatest.top_setup}</div>
                            <div class="ta-setup-details">Entry: ${raoulLatest.summary || 'See journal for details'}</div>
                        </div>
                    ` : ''}
                    ${raoulLatest && raoulLatest.summary ? `
                        <div class="ta-summary">${raoulLatest.summary}</div>
                    ` : ''}
                    ${raoulLatest && raoulLatest.timestamp ? `
                        <div class="ta-timestamp">${raoulLatest.timestamp}</div>
                    ` : ''}
                </div>
            `;
            
            // Ben (Bear) card
            const benLatest = ben.sessions && ben.sessions.length > 0 ? ben.sessions[ben.sessions.length - 1] : null;
            const benDir = getDirection(benLatest);
            
            html += `
                <div class="ta-card bear">
                    <div class="ta-header">
                        <div class="ta-agent">
                            <div class="ta-avatar">B</div>
                            <div>
                                <div class="ta-agent-name">Ben</div>
                                <div class="ta-agent-role">VP Bear</div>
                            </div>
                        </div>
                        <div class="ta-direction bear">${benDir === 'bear' ? '‚Üì' : benDir === 'bull' ? '‚Üë' : '‚Üí'}</div>
                    </div>
                    ${benLatest && benLatest.btc_price ? `
                        <div class="ta-prices">
                            <div class="ta-price">
                                <span class="ta-price-label">BTC</span>
                                <span class="ta-price-value">$${parseFloat(benLatest.btc_price).toLocaleString()}</span>
                            </div>
                            <div class="ta-price">
                                <span class="ta-price-label">ETH</span>
                                <span class="ta-price-value">$${parseFloat(benLatest.eth_price).toLocaleString()}</span>
                            </div>
                        </div>
                    ` : ''}
                    ${benLatest && benLatest.short_candidates && benLatest.short_candidates.length > 0 ? `
                        <div class="ta-setup">
                            <div class="ta-setup-label">Short Candidates</div>
                            <div class="ta-setup-token">${benLatest.short_candidates.join(', ')}</div>
                            <div class="ta-setup-details">${benLatest.summary || 'Monitoring for entries'}</div>
                        </div>
                    ` : ''}
                    ${benLatest && benLatest.summary ? `
                        <div class="ta-summary">${benLatest.summary}</div>
                    ` : ''}
                    ${benLatest && benLatest.timestamp ? `
                        <div class="ta-timestamp">${benLatest.timestamp}</div>
                    ` : ''}
                </div>
            `;
            
            grid.innerHTML = html;
            
            // Calculate consensus
            const consensusEl = document.getElementById('consensus-value');
            if (raoulDir === 'bull' && benDir === 'bear') {
                consensusEl.textContent = '‚ö†Ô∏è Split ‚Äî Cautious';
                consensusEl.className = 'consensus-value cautious';
            } else if (raoulDir === 'bull' && (benDir === 'sideways' || !benDir)) {
                consensusEl.textContent = 'üü¢ Bullish Bias';
                consensusEl.className = 'consensus-value strong-bull';
            } else if (benDir === 'bear' && (raoulDir === 'sideways' || !raoulDir)) {
                consensusEl.textContent = 'üî¥ Bearish Bias';
                consensusEl.className = 'consensus-value strong-bear';
            } else if (raoulDir === benDir) {
                if (raoulDir === 'bull') {
                    consensusEl.textContent = 'üü¢üü¢ Strong Bull Signal';
                    consensusEl.className = 'consensus-value strong-bull';
                } else if (raoulDir === 'bear') {
                    consensusEl.textContent = 'üî¥üî¥ Strong Bear Signal';
                    consensusEl.className = 'consensus-value strong-bear';
                } else {
                    consensusEl.textContent = '‚ö™ Neutral';
                    consensusEl.className = 'consensus-value cautious';
                }
            } else {
                consensusEl.textContent = '‚Äî No clear signal';
                consensusEl.className = 'consensus-value';
            }
        }
        
        // Render Reports
        function renderReports(data) {
            const grid = document.getElementById('reports-grid');
            
            let html = '';
            
            // Scout Reports
            html += `
                <div class="report-category">
                    <div class="report-category-title">üì∞ Scout Reports (Research)</div>
                    ${data.reports.scout && data.reports.scout.length > 0 ? 
                        data.reports.scout.slice(0, 5).map(r => `
                            <div class="report-item">
                                <a href="/vault/Scout/${r.name}" class="report-name" target="_blank">${r.name}</a>
                                <span class="report-date">${formatDate(r.modified)}</span>
                            </div>
                        `).join('') :
                        '<div class="no-data">No Scout reports yet</div>'
                    }
                </div>
            `;
            
            // Quill Reports
            html += `
                <div class="report-category">
                    <div class="report-category-title">üìù Quill Reports (Content)</div>
                    ${data.reports.quill && data.reports.quill.length > 0 ? 
                        data.reports.quill.slice(0, 5).map(r => `
                            <div class="report-item">
                                <a href="/vault/Quill/${r.name}" class="report-name" target="_blank">${r.name}</a>
                                <span class="report-date">${formatDate(r.modified)}</span>
                            </div>
                        `).join('') :
                        '<div class="no-data">No Quill reports yet</div>'
                    }
                </div>
            `;
            
            // Chirp (Twitter)
            html += `
                <div class="report-category">
                    <div class="report-category-title">üê¶ Chirp (Social)</div>
                    ${data.reports.chirp && data.reports.chirp.length > 0 ? 
                        data.reports.chirp.slice(0, 3).map(r => `
                            <div class="report-item">
                                <a href="/vault/Chirp/${r.name}" class="report-name" target="_blank">${r.name}</a>
                                <span class="report-date">${formatDate(r.modified)}</span>
                            </div>
                        `).join('') :
                        '<div class="no-data">No Chirp output yet</div>'
                    }
                </div>
            `;
            
            // Dev Build Log
            html += `
                <div class="report-category">
                    <div class="report-category-title">‚öôÔ∏è Dev Build Log</div>
                    ${data.reports.dev_build ? 
                        `<div class="report-item">
                            <a href="/vault/Dev/${data.reports.dev_build.name}" class="report-name" target="_blank">${data.reports.dev_build.name}</a>
                            <span class="report-date">${formatDate(data.reports.dev_build.modified)}</span>
                        </div>` :
                        '<div class="no-data">No build logs yet</div>'
                    }
                </div>
            `;
            
            // TA Reports links
            html += `
                <div class="report-category">
                    <div class="report-category-title">üìä TA & Market</div>
                    <div class="report-item">
                        <a href="/screener.html" class="report-name" target="_blank">RSI Screener</a>
                    </div>
                    <div class="report-item">
                        <a href="/confluence.html" class="report-name" target="_blank">RSI Confluence Heatmap</a>
                    </div>
                    <div class="report-item">
                        <a href="/portfolio.html" class="report-name" target="_blank">Portfolio & Positions</a>
                    </div>
                </div>
            `;
            
            grid.innerHTML = html;
        }
        
        // Render Health
        function renderHealth(data) {
            const grid = document.getElementById('health-grid');
            
            if (!data.health || !data.health.services || data.health.services.length === 0) {
                grid.innerHTML = '<div class="no-data">No health data available</div>';
                return;
            }
            
            grid.innerHTML = data.health.services.map(s => `
                <div class="health-item">
                    <div class="health-name">${s.name}</div>
                    <div class="health-status ${s.status}">${s.status}</div>
                </div>
            `).join('');
        }
        
        // Render sentiment (placeholder - would need RSI data)
        function renderSentiment() {
            const el = document.getElementById('sentiment-value');
            // In production, fetch actual RSI data
            // For now, show neutral until real data
            el.textContent = '‚Äî Need RSI data';
            el.className = 'sentiment-value neutral';
        }
        
        // Load data
        async function loadData() {
            try {
                const response = await fetch('/data/mission-control.json');
                mcData = await response.json();
                
                // Update timestamp
                document.getElementById('update-time').textContent = new Date().toLocaleTimeString();
                
                // Render sections
                renderAgents(mcData);
                renderTAReports(mcData.raoul, mcData.ben);
                renderReports(mcData);
                renderHealth(mcData);
                renderSentiment();
                renderTrades();
                renderResearch();
                
            } catch (err) {
                console.error('Failed to load mission control data:', err);
                document.getElementById('agent-grid').innerHTML = 
                    '<div class="no-data">Failed to load data. Check if data script is running.</div>';
            }
        }
        
        // Price update handler
        window.onPriceUpdate = function(symbol, price) {
            const el = document.getElementById(`price-${symbol}`);
            if (el) {
                el.textContent = formatCurrency(price);
            }
        };
        
        // Initial load
        loadData();
        
        // Auto-refresh every 60 seconds
        setInterval(loadData, 60000);
    </script>
</body>
</html>
