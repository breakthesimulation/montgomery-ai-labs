<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
  <title>RSI History | Montgomery AI Labs</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0c; --card: #121216; --border: #1e1e24; --text: #fff; --text-muted: #6b7280; --green: #00ff94; --red: #ff4757; --yellow: #fbbf24; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        
        header { margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
        h1 { font-size: 1.3rem; margin-bottom: 4px; }
        .subtitle { color: var(--text-muted); font-size: 0.85rem; }
        
        .controls { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .coin-btn { background: var(--card); border: 1px solid var(--border); color: var(--text); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 0.85rem; }
        .coin-btn.active { background: var(--green); color: #000; border-color: var(--green); }
        .coin-btn:hover { border-color: var(--green); }
        
        .chart-container { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .chart { width: 100%; height: 400px; position: relative; }
        
        .legend { display: flex; gap: 20px; margin-top: 12px; font-size: 0.75rem; color: var(--text-muted); }
        .legend-item { display: flex; align-items: center; gap: 6px; }
        .legend-line { width: 20px; height: 3px; }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px; }
        .stat { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 12px; text-align: center; }
        .stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; }
        .stat-value { font-size: 1.1rem; font-weight: 700; margin-top: 4px; }
        
        .empty { text-align: center; padding: 40px; color: var(--text-muted); }
        
        .footer { margin-top: 20px; text-align: center; color: var(--text-muted); font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå°Ô∏è RSI History</h1>
            <p class="subtitle">Track RSI trends over time - spot when market cools off</p>
        </header>
        
        <div class="controls" id="coins"></div>
        
        <div class="chart-container">
            <div class="chart" id="chart"></div>
            <div class="legend">
                <div class="legend-item"><div class="legend-line" style="background:var(--green)"></div> Oversold (&lt;30)</div>
                <div class="legend-item"><div class="legend-line" style="background:var(--red)"></div> Overbought (&gt;70)</div>
                <div class="legend-item"><div class="legend-line" style="background:var(--text-muted)"></div> Neutral</div>
            </div>
        </div>
        
        <div class="stats" id="stats"></div>
        
        <p class="footer" id="updated"></p>
    </div>
    
    <script>
    let history = [];
    let selectedCoins = [];
    
    async function load() {
        try {
            const resp = await fetch('/data/rsi_history.json');
            const data = await resp.json();
            history = data.history || [];
            
            // Get all coins
            const coins = new Set();
            history.forEach(entry => {
                Object.keys(entry.readings || {}).forEach(c => coins.add(c));
            });
            
            // Show coin buttons
            const coinsDiv = document.getElementById('coins');
            coinsDiv.innerHTML = '<button class="coin-btn active" onclick="toggleAll()">All</button>';
            Array.from(coins).sort().forEach(coin => {
                coinsDiv.innerHTML += `<button class="coin-btn" onclick="toggleCoin('${coin}')">${coin}</button>`;
            });
            
            // Select all by default
            selectedCoins = Array.from(coins);
            
            render();
        } catch(e) {
            document.getElementById('chart').innerHTML = '<div class="empty">No data yet</div>';
        }
    }
    
    function toggleCoin(coin) {
        if (selectedCoins.includes(coin)) {
            selectedCoins = selectedCoins.filter(c => c !== coin);
        } else {
            selectedCoins.push(coin);
        }
        render();
    }
    
    function toggleAll() {
        const coins = new Set();
        history.forEach(entry => {
            Object.keys(entry.readings || {}).forEach(c => coins.add(c));
        });
        selectedCoins = Array.from(coins);
        render();
    }
    
    function render() {
        if (!history.length) {
            document.getElementById('chart').innerHTML = '<div class="empty">Not enough data yet</div>';
            return;
        }
        
        // Filter and aggregate
        const timestamps = history.map(h => h.timestamp);
        const startTime = new Date(timestamps[0]).getTime();
        
        // Get data points
        const datasets = {};
        selectedCoins.forEach(coin => {
            const points = [];
            history.forEach((entry, i) => {
                const rsi = entry.readings?.[coin];
                if (rsi !== undefined) {
                    points.push({ x: i, y: rsi, time: entry.timestamp });
                }
            });
            if (points.length > 0) {
                datasets[coin] = points;
            }
        });
        
        // Build SVG
        const width = 1000;
        const height = 350;
        const padding = 40;
        
        let svg = `<svg viewBox="0 0 ${width} ${height}" style="width:100%;height:100%">`;
        
        // Background zones
        svg += `<rect x="${padding}" y="${padding}" width="${width-2*padding}" height="${height-2*padding}" fill="#0a0a0c"/>`;
        
        // RSI lines
        const colors = ['#00ff94', '#ff4757', '#3b82f6', '#fbbf24', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];
        
        let colorIdx = 0;
        Object.entries(datasets).forEach(([coin, points]) => {
            if (points.length < 2) return;
            
            const color = colors[colorIdx % colors.length];
            colorIdx++;
            
            // Build path
            let path = '';
            points.forEach((p, i) => {
                const x = padding + (i / (points.length - 1)) * (width - 2 * padding);
                const y = height - padding - (p.y / 100) * (height - 2 * padding);
                path += (i === 0 ? 'M' : 'L') + `${x},${y} `;
            });
            
            // Draw line
            svg += `<path d="${path}" stroke="${color}" stroke-width="2" fill="none"/>`;
            
            // Draw labels
            const last = points[points.length - 1];
            const lastX = padding + ((points.length - 1) / (points.length - 1)) * (width - 2 * padding);
            const lastY = height - padding - (last.y / 100) * (height - 2 * padding);
            svg += `<text x="${lastX + 5}" y="${lastY + 4}" fill="${color}" font-size="11">${coin}</text>`;
        });
        
        // Reference lines
        const y30 = height - padding - (30 / 100) * (height - 2 * padding);
        const y70 = height - padding - (70 / 100) * (height - 2 * padding);
        
        svg += `<line x1="${padding}" y1="${y30}" x2="${width-padding}" y2="${y30}" stroke="var(--green)" stroke-dasharray="4" opacity="0.5"/>`;
        svg += `<line x1="${padding}" y1="${y70}" x2="${width-padding}" y2="${y70}" stroke="var(--red)" stroke-dasharray="4" opacity="0.5"/>`;
        svg += `<text x="${padding + 5}" y="${y30 - 5}" fill="var(--green)" font-size="10">30</text>`;
        svg += `<text x="${padding + 5}" y="${y70 - 5}" fill="var(--red)" font-size="10">70</text>`;
        
        svg += '</svg>';
        
        document.getElementById('chart').innerHTML = svg;
        
        // Stats
        let overbought = 0, oversold = 0;
        const latest = history[history.length - 1]?.readings || {};
        Object.entries(latest).forEach(([coin, rsi]) => {
            if (rsi > 70) overbought++;
            if (rsi < 30) oversold++;
        });
        
        document.getElementById('stats').innerHTML = `
            <div class="stat"><div class="stat-value">${Object.keys(latest).length}</div><div class="stat-label">Coins Tracked</div></div>
            <div class="stat"><div class="stat-value" style="color:var(--red)">${overbought}</div><div class="stat-label">Overbought</div></div>
            <div class="stat"><div class="stat-value" style="color:var(--green)">${oversold}</div><div class="stat-label">Oversold</div></div>
            <div class="stat"><div class="stat-value">${history.length}</div><div class="stat-label">Data Points</div></div>
        `;
        
        document.getElementById('updated').textContent = 'Last updated: ' + new Date(history[history.length-1]?.timestamp).toLocaleString();
    }
    
    load();
    setInterval(load, 60000);
    </script>
</body>
</html>
