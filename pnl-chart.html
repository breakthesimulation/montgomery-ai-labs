<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
  <title>P&L Chart | Montgomery AI Labs</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0a0a0c; --card: #121216; --border: #1e1e24; --text: #fff; --text-muted: #6b7280; --green: #00ff94; --red: #ff4757; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        header { margin-bottom: 24px; }
        h1 { font-size: 1.3rem; margin-bottom: 4px; }
        .subtitle { color: var(--text-muted); }
        
        .chart { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; height: 350px; position: relative; }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px; }
        .stat { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 16px; text-align: center; }
        .stat-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; }
        .stat-value { font-size: 1.2rem; font-weight: 700; font-family: 'IBM Plex Mono'; margin-top: 4px; }
        
        .footer { margin-top: 20px; text-align: center; color: var(--text-muted); font-size: 0.75rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“ˆ P&L Chart</h1>
            <p class="subtitle">Equity curve from paper trades</p>
        </header>
        
        <div class="chart" id="chart"></div>
        
        <div class="stats" id="stats"></div>
        
        <p class="footer" id="updated"></p>
    </div>
    
    <script>
    async function load() {
        try {
            const resp = await fetch('/data/hl_paper_trades.json');
            const data = await resp.json();
            
            const trades = data.trades || [];
            const sorted = trades.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
            
            // Build equity curve
            let balance = 10000;
            const points = [{date: 'Start', balance: 10000, pnl: 0}];
            
            sorted.forEach(t => {
                if (t.status === 'CLOSED') {
                    balance = balance * (1 + t.pnl / 100);
                    points.push({
                        date: (t.exit_timestamp || '').slice(0, 10),
                        balance: balance,
                        pnl: t.pnl,
                        coin: t.coin
                    });
                }
            });
            
            // Current balance
            const current = points[points.length - 1].balance;
            const totalPnl = ((current - 10000) / 10000) * 100;
            const maxDD = Math.min(...points.map(p => (p.balance - 10000) / 10000 * 100));
            
            // Stats
            document.getElementById('stats').innerHTML = `
                <div class="stat">
                    <div class="stat-label">Starting</div>
                    <div class="stat-value">$10,000</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Current</div>
                    <div class="stat-value ${totalPnl >= 0 ? 'positive' : 'negative'}">$${current.toFixed(0)}</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Total P&L</div>
                    <div class="stat-value ${totalPnl >= 0 ? 'positive' : 'negative'}">${totalPnl >= 0 ? '+' : ''}${totalPnl.toFixed(1)}%</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Max Drawdown</div>
                    <div class="stat-value negative">${maxDD.toFixed(1)}%</div>
                </div>
            `;
            
            // Draw SVG
            const width = 800;
            const height = 280;
            const padding = 40;
            
            const minBal = Math.min(...points.map(p => p.balance)) * 0.95;
            const maxBal = Math.max(...points.map(p => p.balance)) * 1.05;
            
            let svg = `<svg viewBox="0 0 ${width} ${height}" style="width:100%;height:100%">`;
            
            // Grid
            for (let i = 0; i <= 4; i++) {
                const y = padding + (i / 4) * (height - 2 * padding);
                svg += `<line x1="${padding}" y1="${y}" x2="${width - padding}" y2="${y}" stroke="#1e1e24" stroke-dasharray="4"/>`;
            }
            
            // Line
            let path = '';
            points.forEach((p, i) => {
                const x = padding + (i / (points.length - 1)) * (width - 2 * padding);
                const y = height - padding - ((p.balance - minBal) / (maxBal - minBal)) * (height - 2 * padding);
                path += (i === 0 ? 'M' : 'L') + `${x},${y} `;
            });
            
            svg += `<path d="${path}" stroke="var(--green)" stroke-width="3" fill="none"/>`;
            
            // Points
            points.forEach((p, i) => {
                const x = padding + (i / (points.length - 1)) * (width - 2 * padding);
                const y = height - padding - ((p.balance - minBal) / (maxBal - minBal)) * (height - 2 * padding);
                svg += `<circle cx="${x}" cy="${y}" r="5" fill="${p.pnl >= 0 ? 'var(--green)' : 'var(--red)'}"/>`;
            });
            
            svg += '</svg>';
            
            document.getElementById('chart').innerHTML = svg;
            document.getElementById('updated').textContent = 'Updated: ' + new Date().toLocaleString();
            
        } catch(e) {
            document.getElementById('chart').innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted)">Loading...</div>';
        }
    }
    
    load();
    </script>
</body>
</html>
