<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
  <title>Trading Charts - Montgomery AI Labs</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0d1117;
            color: #e6edf3;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #58a6ff;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        select {
            padding: 10px 15px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #e6edf3;
            font-size: 1rem;
            cursor: pointer;
        }
        select:hover {
            border-color: #58a6ff;
        }
        .chart-container {
            background: #161b22;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        .rsi-wrapper {
            position: relative;
            height: 150px;
            margin-top: 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: #161b22;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #30363d;
        }
        .stat-label {
            font-size: 0.85rem;
            color: #8b949e;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .stat-value.up { color: #3fb950; }
        .stat-value.down { color: #f85149; }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #8b949e;
        }
        .back-link {
            display: inline-block;
            color: #58a6ff;
            text-decoration: none;
            margin-bottom: 20px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/index.html" class="back-link">‚Üê Back to Dashboard</a>
        <h1>üìä Trading Charts</h1>
        
        <div class="controls">
            <select id="symbolSelect">
                <option value="BTC">BTC - Bitcoin</option>
                <option value="ETH">ETH - Ethereum</option>
                <option value="SOL">SOL - Solana</option>
                <option value="NEAR">NEAR - NEAR Protocol</option>
                <option value="FIL">FIL - Filecoin</option>
                <option value="UNI">UNI - Uniswap</option>
                <option value="ARB">ARB - Arbitrum</option>
                <option value="INJ">INJ - Injective</option>
                <option value="YGG">YGG - Yield Guild</option>
                <option value="SNX">SNX - Synthetix</option>
                <option value="OP">OP - Optimism</option>
                <option value="CRV">CRV - Curve DAO</option>
            </select>
            
            <select id="intervalSelect">
                <option value="15m">15 Minutes</option>
                <option value="1h" selected>1 Hour</option>
                <option value="4h">4 Hours</option>
                <option value="1D">1 Day</option>
            </select>
            
            <button onclick="loadChart()" style="
                padding: 10px 20px;
                background: #238636;
                border: none;
                border-radius: 6px;
                color: white;
                cursor: pointer;
                font-size: 1rem;
            ">Load Chart</button>
        </div>
        
        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-label">Current Price</div>
                <div class="stat-value" id="currentPrice">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">24h Change</div>
                <div class="stat-value" id="priceChange">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">24h High</div>
                <div class="stat-value" id="highPrice">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">24h Low</div>
                <div class="stat-value" id="lowPrice">--</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">RSI (14)</div>
                <div class="stat-value" id="rsiValue">--</div>
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="priceChart"></canvas>
            </div>
            <div class="rsi-wrapper">
                <canvas id="rsiChart"></canvas>
            </div>
        </div>
        
        <div style="color: #8b949e; font-size: 0.85rem;">
            Data sourced from Binance API ‚Ä¢ Auto-refreshes every 15 minutes
        </div>
    </div>

    <script>
        let priceChart = null;
        let rsiChart = null;
        
        async function loadChart() {
            const symbol = document.getElementById('symbolSelect').value;
            const interval = document.getElementById('intervalSelect').value;
            
            try {
                const response = await fetch(`/data/candles/${symbol}_${interval}.json`);
                const data = await response.json();
                
                if (!data || !data.candles) {
                    alert('No data available for this selection');
                    return;
                }
                
                updateStats(data);
                renderPriceChart(data.candles, symbol);
                renderRSIChart(data.rsi || [], data.candles);
                
            } catch (error) {
                console.error('Error loading chart:', error);
                alert('Error loading chart data. Please try again.');
            }
        }
        
        function updateStats(data) {
            const candles = data.candles;
            const latest = candles[candles.length - 1];
            const prev = candles[candles.length - 2] || latest;
            
            document.getElementById('currentPrice').textContent = '$' + latest.close.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            const change = ((latest.close - prev.close) / prev.close * 100);
            const changeEl = document.getElementById('priceChange');
            changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            changeEl.className = 'stat-value ' + (change >= 0 ? 'up' : 'down');
            
            document.getElementById('highPrice').textContent = '$' + latest.high.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('lowPrice').textContent = '$' + latest.low.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            
            // RSI
            const rsiData = data.rsi || [];
            const latestRSI = rsiData.length > 0 ? rsiData[rsiData.length - 1].rsi : null;
            const rsiEl = document.getElementById('rsiValue');
            if (latestRSI !== null) {
                rsiEl.textContent = latestRSI.toFixed(1);
                if (latestRSI > 70) rsiEl.style.color = '#f85149';
                else if (latestRSI < 30) rsiEl.style.color = '#3fb950';
                else rsiEl.style.color = '#e6edf3';
            } else {
                rsiEl.textContent = '--';
            }
        }
        
        function renderPriceChart(candles, symbol) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (priceChart) {
                priceChart.destroy();
            }
            
            const labels = candles.map(c => new Date(c.openTime));
            const prices = candles.map(c => c.close);
            const volumes = candles.map(c => c.volume);
            
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${symbol}/USDT Price`,
                        data: prices,
                        borderColor: '#58a6ff',
                        backgroundColor: 'rgba(88, 166, 255, 0.1)',
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                tooltipFormat: 'PPpp'
                            },
                            grid: {
                                color: '#30363d'
                            },
                            ticks: { color: '#8b949e' }
                        },
                        y: {
                            grid: {
                                color: '#30363d'
                            },
                            ticks: { 
                                color: '#8b949e',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#e6edf3' }
                        },
                        tooltip: {
                            backgroundColor: '#161b22',
                            titleColor: '#e6edf3',
                            bodyColor: '#e6edf3',
                            borderColor: '#30363d',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `$${context.raw.toLocaleString()}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function renderRSIChart(rsiData, candles) {
            const ctx = document.getElementById('rsiChart').getContext('2d');
            
            if (rsiChart) {
                rsiChart.destroy();
            }
            
            if (!rsiData || rsiData.length === 0) {
                // Calculate RSI from candles
                rsiData = calculateRSI(candles);
            }
            
            const labels = rsiData.map(r => new Date(r.time));
            const rsiValues = rsiData.map(r => r.rsi);
            
            rsiChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'RSI (14)',
                        data: rsiValues,
                        borderColor: '#a371f7',
                        backgroundColor: 'rgba(163, 113, 247, 0.1)',
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0
                    },
                    {
                        label: 'Overbought (70)',
                        data: labels.map(() => 70),
                        borderColor: 'rgba(248, 81, 73, 0.3)',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        borderWidth: 1,
                        fill: false
                    },
                    {
                        label: 'Oversold (30)',
                        data: labels.map(() => 30),
                        borderColor: 'rgba(63, 185, 80, 0.3)',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        borderWidth: 1,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            min: 0,
                            max: 100,
                            grid: {
                                color: '#30363d'
                            },
                            ticks: { color: '#8b949e' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { 
                                color: '#e6edf3',
                                filter: function(item) {
                                    return !item.text.includes('(');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function calculateRSI(candles, period = 14) {
            const closes = candles.map(c => c.close);
            const rsiValues = [];
            
            for (let i = period; i < closes.length; i++) {
                let gains = 0, losses = 0;
                
                for (let j = i - period + 1; j <= i; j++) {
                    const change = closes[j] - closes[j - 1];
                    if (change > 0) gains += change;
                    else losses += Math.abs(change);
                }
                
                const avgGain = gains / period;
                const avgLoss = losses / period;
                
                let rsi = 50;
                if (avgLoss === 0) {
                    rsi = 100;
                } else {
                    const rs = avgGain / avgLoss;
                    rsi = 100 - (100 / (1 + rs));
                }
                
                rsiValues.push({
                    time: candles[i].openTime,
                    rsi: rsi
                });
            }
            
            return rsiValues;
        }
        
        // Load default chart on page load
        document.addEventListener('DOMContentLoaded', loadChart);
    </script>
</body>
</html>
